<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" type="text/css" href="./../DataTables/Bootstrap-3.3.5/css/bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="./../DataTables/DataTables-1.10.10/css/dataTables.bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="./../DataTables/AutoFill-2.1.0/css/autoFill.bootstrap.css"/>
    <link rel="stylesheet" type="text/css" href="./../DataTables/Buttons-1.1.0/css/buttons.bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="./../DataTables/ColReorder-1.3.0/css/colReorder.bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="./../DataTables/Editor-1.5.4/css/editor.bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="./../DataTables/FixedColumns-3.2.0/css/fixedColumns.bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="./../DataTables/FixedHeader-3.1.0/css/fixedHeader.bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="./../DataTables/Responsive-2.0.0/css/responsive.bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="./../DataTables/RowReorder-1.1.0/css/rowReorder.bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="./../DataTables/Scroller-1.4.0/css/scroller.bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="./../DataTables/Select-1.1.0/css/select.bootstrap.min.css"/>

    <script type="text/javascript" src="./../DataTables/jQuery-2.1.4/jquery-2.1.4.min.js"></script>
    <script type="text/javascript" src="./../DataTables/Bootstrap-3.3.5/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="./../DataTables/DataTables-1.10.10/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="./../DataTables/DataTables-1.10.10/js/dataTables.bootstrap.min.js"></script>
    <script type="text/javascript" src="./../DataTables/AutoFill-2.1.0/js/dataTables.autoFill.min.js"></script>
    <script type="text/javascript" src="./../DataTables/AutoFill-2.1.0/js/autoFill.bootstrap.min.js"></script>
    <script type="text/javascript" src="./../DataTables/Buttons-1.1.0/js/dataTables.buttons.min.js"></script>
    <script type="text/javascript" src="./../DataTables/Buttons-1.1.0/js/buttons.bootstrap.min.js"></script>
    <script type="text/javascript" src="./../DataTables/Buttons-1.1.0/js/buttons.colVis.min.js"></script>
    <script type="text/javascript" src="./../DataTables/ColReorder-1.3.0/js/dataTables.colReorder.min.js"></script>
    <script type="text/javascript" src="./../DataTables/Editor-1.5.4/js/dataTables.editor.js"></script>
    <script type="text/javascript" src="./../DataTables/Editor-1.5.4/js/editor.bootstrap.js"></script>
    <script type="text/javascript" src="./../DataTables/FixedColumns-3.2.0/js/dataTables.fixedColumns.min.js"></script>
    <script type="text/javascript" src="./../DataTables/FixedHeader-3.1.0/js/dataTables.fixedHeader.min.js"></script>
    <script type="text/javascript" src="./../DataTables/Responsive-2.0.0/js/dataTables.responsive.min.js"></script>
    <script type="text/javascript" src="./../DataTables/Responsive-2.0.0/js/responsive.bootstrap.min.js"></script>
    <script type="text/javascript" src="./../DataTables/RowReorder-1.1.0/js/dataTables.rowReorder.min.js"></script>
    <script type="text/javascript" src="./../DataTables/Scroller-1.4.0/js/dataTables.scroller.min.js"></script>
    <script type="text/javascript" src="./../DataTables/Select-1.1.0/js/dataTables.select.min.js"></script>

    <script src="../../resources/app.js"></script>
    <script>
        var editor;
        $.extend($.fn.dataTable.defaults, {
            dom: "<'row'<'col-sm-6'><'col-sm-6'>>" +
            "<'row'<'col-sm-3'l><'col-sm-3'B><'col-sm-6'f>>" +
            "<'row'<'col-sm-12'tr>>" +
            "<'row'<'col-sm-5'i><'col-sm-7'p>>",
            renderer: 'bootstrap'
        });

        $(document).ready(function () {

            editor = new $.fn.dataTable.Editor({
                ajax: "../../resources/data/datatable.json",
                table: "#example",
                idSrc: 'DT_RowId',
                //display: 'envelope',
                fields: [{
                    label: "First name:",
                    name: "first_name"
                }, {
                    label: "Last name:",
                    name: "last_name"
                }, {
                    label: "Position:",
                    name: "position"
                }, {
                    label: "Office:",
                    name: "office"
                }, {
                    label: "Extension:",
                    name: "extn"
                }, {
                    label: "Start date:",
                    name: "start_date",
                    type: "datetime"
                }, {
                    label: "Salary:",
                    name: "salary"
                }
                ], i18n: {
                    create: {

                        title: "添加记录",
                        submit: "提交"
                    },
                    edit: {

                        title: "修改记录",
                        submit: "更新"
                    },
                    remove: {
                        title: "警告",
                        submit: "确认",
                        confirm: {
                            _: "确定删除 %d 条记录?",
                            1: "确定删除 1 条记录?"
                        }
                    },
                    error: {
                        system: "系统错误"
                    },
                    datetime: {
                        previous: '前',
                        next: '后',
                        //months: ['一', '二', '三', 'Avril', 'Mai', 'Juin', 'Juillet', 'Août', 'Septembre', 'Octobre', 'Novembre', 'Décembre'],
                        //weekdays: ['日', '一', '二', '三', '四', '五', '六']
                    }
                }
            });

            // 单元格编辑
            $('#example').on('click', 'tbody td:not(:first-child)', function (e) {
               //editor.bubble(this);
            });

            var table = $('#example').DataTable({
                ajax: {
                    "url": "../../resources/data/datatable.json",
                    "data": function (d) {
                        d.version = 1;
                        var json = {data:JSON.stringify(d)}
                        return json;
                    }
                },
                processing: true,
                //serverSide: true,
                autoFill: false,//单元格填充
                colReorder: false, //拖动列
                colReorder: {
                    fixedColumnsLeft: 2,
                    fixedColumnsRight: 1
                },
                select: {style: 'multi'},
                columns: [
                    {
                        data: null,
                        render: function (data, type, row) {
                            return '<input type="checkbox" class="checkboxes" value="1" />';
                        }
                    },
                    {
                        data: null,
                        title: "姓名",
                        render: function (data, type, row) {
                            return data.first_name + ' ' + data.last_name;
                        }
                    },
                    {title: "地区", data: "position"},
                    {title: "职位", data: "office"},
                    {title: "薪水", data: "salary", render: $.fn.dataTable.render.number(',', '.', 0, '$')}
                ],
                columnDefs: [{
                    targets: [0],
                    orderData: [0, 1] //如果第一列进行排序，有相同数据则按照第二列顺序排列
                }, {
                    targets: [1],
                    visible: true,
                    searchable: false
                }, {
                    targets: [1],
                    orderData: [4, 0]
                }],
                headerCallback: function (thead, data, start, end, display) {
                    var api = this.api();
                    $(thead).find('th').eq(0).html('<input type="checkbox" class="group-checkable" data-set=".checkboxes" />');
                    jQuery('.group-checkable', $(thead)).on('click', function () {
                        var set = jQuery(this).attr("data-set");
                        var checked = jQuery(this).is(":checked");
                        var table_dom = $(thead).closest('table');
                        jQuery(set,table_dom).each(function () {
                            if (checked) {
                                $(this).prop('checked', true);
                                api.table().row($(this).closest('tr')).select();
                            } else {
                                $(this).prop('checked', false);
                                api.table().row($(this).closest('tr')).deselect();
                            }
                        });
                    });
                },
                buttons: [
                    {extend: "create", text: '创建', editor: editor},
                    {extend: "edit", text: '修改', editor: editor},
                    {extend: "remove", text: '删除', editor: editor},
                    {extend: 'colvis', text: '显示列', columns: ':not(:first-child)'}
                ]
            });

            table.on('preXhr.dt', function (e, settings, data) {
                console.info(data.sessionId);
            });

            table.on('deselect', function (e, dt, type, index) {
                if (type === 'row') {
                    var node = dt.row(index).node();
                    $('input.checkboxes', node).prop('checked', false);
                    var data = dt.row(index).data();
                }
            });

            table.on('select', function (e, dt, type, index) {
                var node = dt.row(index).node();
                $('input.checkboxes', node).prop('checked', true);
                if (type === 'row') {
                    var data = dt.row(index).data();
                }
            });


        });
    </script>
</head>
<body>
<div class="row">
    <div class="well-sm"></div>
    <div class="col-lg-10 col-lg-offset-1">
        <table id="example" class="table table-striped table-bordered cell-border" cellspacing="0" width="100%"></table>
    </div>
</div>
</body>
</html>